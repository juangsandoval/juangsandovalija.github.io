<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario con Excel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <h1>üìä Cargar y Editar Excel</h1>

  <!-- Subir archivo Excel -->
  <input type="file" id="input-excel" accept=".xlsx,.xls" />
  <br><br>

  <!-- Tabla donde se mostrar√° el Excel -->
  <div id="tabla"></div>

  <hr>

  <!-- Formulario -->
  <h2>üìù Formulario</h2>
  <form id="formulario">
    Nombre: <input type="text" id="nombre"><br><br>
    Edad: <input type="number" id="edad"><br><br>
    Ciudad: <input type="text" id="ciudad"><br><br>
    <button type="submit">Agregar al Excel</button>
  </form>

  <br>
  <!-- Bot√≥n para descargar nuevo Excel -->
  <button id="descargar">üíæ Descargar nuevo Excel</button>

  <script>
    let workbook; // Guardamos el Excel cargado
    let datos = []; // Datos le√≠dos de Excel
    let filaActual = 1; // Fila que estamos editando (empezamos con la segunda fila)

    // Leer archivo Excel
    document.getElementById('input-excel').addEventListener('change', (event) => {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = (e) => {
        const data = new Uint8Array(e.target.result);
        workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        datos = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        mostrarTabla(); // Mostrar encabezado y la fila actual
      };
      reader.readAsArrayBuffer(file);
    });

    // Mostrar tabla en HTML (solo encabezado y fila actual)
    function mostrarTabla() {
      let html = "<table border='1' cellpadding='5'>";
      
      // Mostrar encabezado
      html += "<tr>";
      datos[0].forEach(cell => {
        html += `<th>${cell || ""}</th>`;
      });
      html += "</tr>";

      // Mostrar la fila actual
      if (filaActual < datos.length) {
        html += "<tr>";
        datos[filaActual].forEach(cell => {
          html += `<td>${cell || ""}</td>`;
        });
        html += "</tr>";
      } else {
        html += "<tr><td colspan='3'>No hay m√°s filas para editar.</td></tr>";
      }
      html += "</table>";

      document.getElementById('tabla').innerHTML = html;
    }

    // Agregar datos del formulario
    document.getElementById('formulario').addEventListener('submit', (e) => {
      e.preventDefault();
      const nombre = document.getElementById('nombre').value;
      const edad = document.getElementById('edad').value;
      const ciudad = document.getElementById('ciudad').value;

      // Guardar los datos en la fila actual
      datos[filaActual] = [nombre, edad, ciudad];
      filaActual++; // Pasar a la siguiente fila

      // Limpiar el formulario
      document.getElementById('nombre').value = "";
      document.getElementById('edad').value = "";
      document.getElementById('ciudad').value = "";

      // Mostrar tabla con la fila siguiente para llenar
      mostrarTabla();
    });

    // Descargar nuevo Excel
    document.getElementById('descargar').addEventListener('click', () => {
      const hoja = XLSX.utils.aoa_to_sheet(datos);
      const nuevoLibro = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(nuevoLibro, hoja, "Datos");
      XLSX.writeFile(nuevoLibro, "nuevo_datos.xlsx");
    });
  </script>
</body>
</html>
